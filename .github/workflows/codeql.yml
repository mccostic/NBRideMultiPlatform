name: CodeQL

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 3 * * 1' # optional weekly scan

jobs:
  analyze:
    name: CodeQL Analyze (Java/Kotlin)
    runs-on: ubuntu-latest

    permissions:
      actions: read
      contents: read
      security-events: write

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - name: Set up Android SDK
        uses: android-actions/setup-android@v3

      - name: Set up Gradle cache
        uses: gradle/actions/setup-gradle@v3

      - name: Initialize CodeQL (manual build)
        uses: github/codeql-action/init@v3
        with:
          languages: java-kotlin
          build-mode: manual

      # Pick ONE build command that works reliably for your repo.
      - name: Build for CodeQL
        run: |
          ./gradlew -S clean build -x test
          # If thatâ€™s too heavy or fails on Android toolchain, try one of these instead:
          ./gradlew -S :composeApp:assembleDebug
          # ./gradlew -S :core:common:build :core:auth:build :core:mvi:build -x test

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v3